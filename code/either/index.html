<!DOCTYPE html><html lang=""><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:125%/1.5 'Fira Sans',sans-serif;box-sizing:border-box;overflow-y:scroll;-webkit-font-smoothing:antialiased;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.87);font-family:'Fira Sans',sans-serif;font-weight:400;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";letter-spacing:.03em;}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;color:inherit;font-family:'Fira Mono',monospace;font-weight:400;text-rendering:optimizeLegibility;font-size:2rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;color:inherit;font-family:'Fira Mono',monospace;font-weight:400;text-rendering:optimizeLegibility;font-size:1.51572rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;color:inherit;font-family:'Fira Mono',monospace;font-weight:400;text-rendering:optimizeLegibility;font-size:1.31951rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;color:inherit;font-family:'Fira Mono',monospace;font-weight:400;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;color:inherit;font-family:'Fira Mono',monospace;font-weight:400;text-rendering:optimizeLegibility;font-size:0.87055rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;color:inherit;font-family:'Fira Mono',monospace;font-weight:400;text-rendering:optimizeLegibility;font-size:0.81225rem;line-height:1.1;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;}ul{margin-left:1.5rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;list-style-position:outside;list-style-image:none;}ol{margin-left:1.5rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;font-size:0.85rem;line-height:1.5rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;font-size:1rem;line-height:1.5rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;}blockquote{margin-left:-1.5rem;margin-right:1.5rem;margin-top:0;padding-bottom:0;padding-left:1.21875rem;padding-right:0;padding-top:0;margin-bottom:1.5rem;font-size:1.1487rem;line-height:1.5rem;color:hsla(0,0%,0%,0.6);border-left:0.28125rem solid hsla(0,0%,0%,0.87);}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.5rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;}b{font-weight:700;}strong{font-weight:700;}dt{font-weight:700;}th{font-weight:700;}li{margin-bottom:calc(1.5rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.5rem;margin-bottom:calc(1.5rem / 2);margin-top:calc(1.5rem / 2);}li > ul{margin-left:1.5rem;margin-bottom:calc(1.5rem / 2);margin-top:calc(1.5rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.5rem / 2);}code{font-size:0.85rem;line-height:1.5rem;}kbd{font-size:0.85rem;line-height:1.5rem;}samp{font-size:0.85rem;line-height:1.5rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1rem;padding-right:1rem;padding-top:0.75rem;padding-bottom:calc(0.75rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}a{color:inherit;}a:hover{color:#3498DB;}@media only screen and (max-width:480px){blockquote{margin-left:-1.125rem;padding-left:0.84375rem;margin-right:0;}}</style><meta name="generator" content="Gatsby 5.13.3"/><meta name="theme-color" content="#663399"/><meta data-react-helmet="true" name="description" content="Welcome to yet another post on the Internet about Monads! I am only mostly
kidding. I do not intend to use this post as an introduction to
Monads1. This post is…"/><meta data-react-helmet="true" property="og:title" content="Errors and Either"/><meta data-react-helmet="true" property="og:description" content="Welcome to yet another post on the Internet about Monads! I am only mostly
kidding. I do not intend to use this post as an introduction to
Monads1. This post is…"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" property="og:url"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="Jean-Louis Leysens"/><meta data-react-helmet="true" name="twitter:title" content="Errors and Either"/><meta data-react-helmet="true" name="twitter:description" content="Welcome to yet another post on the Internet about Monads! I am only mostly
kidding. I do not intend to use this post as an introduction to
Monads1. This post is…"/><meta data-react-helmet="true" name="keywords" content="sombrerob.ro, sombrerobro, jloleysens, JeanLouis, Jean-Louis, Leysens, blog"/><style data-href="/styles.33fc7383722d6a835455.css" data-identity="gatsby-global-css">@font-face{font-display:swap;font-family:Fira Mono;font-style:normal;font-weight:400;src:local("Fira Mono Regular "),local("Fira Mono-Regular"),url(/static/fira-mono-latin-400-08b283aa43aba936400a2e133c714bf5.woff2) format("woff2"),url(/static/fira-mono-latin-400-290dbae9f31383746f5ca9b2785d85b7.woff) format("woff")}@font-face{font-display:swap;font-family:Fira Mono;font-style:normal;font-weight:500;src:local("Fira Mono Medium "),local("Fira Mono-Medium"),url(/static/fira-mono-latin-500-47abe25ca246a2e392fe445e23699d58.woff2) format("woff2"),url(/static/fira-mono-latin-500-abc3c06b49b5d526f4257de806bdf551.woff) format("woff")}@font-face{font-display:swap;font-family:Fira Mono;font-style:normal;font-weight:700;src:local("Fira Mono Bold "),local("Fira Mono-Bold"),url(/static/fira-mono-latin-700-0d86647d4dbd6d0693c874bb0de90054.woff2) format("woff2"),url(/static/fira-mono-latin-700-e841d2e7da3f123e17c1696039b31674.woff) format("woff")}@font-face{font-display:swap;font-family:Fira Sans;font-style:normal;font-weight:100;src:local("Fira Sans Thin "),local("Fira Sans-Thin"),url(/static/fira-sans-latin-100-231d8dc2259c709b9fcf0c46e25c6139.woff2) format("woff2"),url(/static/fira-sans-latin-100-3773ce56a59b40f5f732f3f8a16ea4ba.woff) format("woff")}@font-face{font-display:swap;font-family:Fira Sans;font-style:italic;font-weight:100;src:local("Fira Sans Thin italic"),local("Fira Sans-Thinitalic"),url(/static/fira-sans-latin-100italic-3a0b163345d21f46c48405fca57d990c.woff2) format("woff2"),url(/static/fira-sans-latin-100italic-3385da63583e873a9a7db19e0f7b0ab0.woff) format("woff")}@font-face{font-display:swap;font-family:Fira Sans;font-style:normal;font-weight:200;src:local("Fira Sans Extra Light "),local("Fira Sans-Extra Light"),url(/static/fira-sans-latin-200-9901bbbcdcbad02db5d12497ec5da166.woff2) format("woff2"),url(/static/fira-sans-latin-200-61a663c97c689e35d9677ca28f323182.woff) format("woff")}@font-face{font-display:swap;font-family:Fira Sans;font-style:italic;font-weight:200;src:local("Fira Sans Extra Light italic"),local("Fira Sans-Extra Lightitalic"),url(/static/fira-sans-latin-200italic-88554f89c61df6a4e80731656ba80a2e.woff2) format("woff2"),url(/static/fira-sans-latin-200italic-7524332096c6c0d064d6aebdc6624726.woff) format("woff")}@font-face{font-display:swap;font-family:Fira Sans;font-style:normal;font-weight:300;src:local("Fira Sans Light "),local("Fira Sans-Light"),url(/static/fira-sans-latin-300-e885f8f3c22f1d8bf0f8e5946683a94b.woff2) format("woff2"),url(/static/fira-sans-latin-300-6adc7c31647b9e18bbb76d78be636307.woff) format("woff")}@font-face{font-display:swap;font-family:Fira Sans;font-style:italic;font-weight:300;src:local("Fira Sans Light italic"),local("Fira Sans-Lightitalic"),url(/static/fira-sans-latin-300italic-476fc54bdd80f758b403ca763d50a6f7.woff2) format("woff2"),url(/static/fira-sans-latin-300italic-bab5921ebebfb247effe474913d1e2bc.woff) format("woff")}@font-face{font-display:swap;font-family:Fira Sans;font-style:normal;font-weight:400;src:local("Fira Sans Regular "),local("Fira Sans-Regular"),url(/static/fira-sans-latin-400-d9506f36795a08de33aac697918f030c.woff2) format("woff2"),url(/static/fira-sans-latin-400-a25b24ae2f4e8d9d1ae0f14e0800bea0.woff) format("woff")}@font-face{font-display:swap;font-family:Fira Sans;font-style:italic;font-weight:400;src:local("Fira Sans Regular italic"),local("Fira Sans-Regularitalic"),url(/static/fira-sans-latin-400italic-203fb706a6af662c7825de7b59b8a616.woff2) format("woff2"),url(/static/fira-sans-latin-400italic-7ea80d863f9ea7fce0112cffb371c9ba.woff) format("woff")}@font-face{font-display:swap;font-family:Fira Sans;font-style:normal;font-weight:500;src:local("Fira Sans Medium "),local("Fira Sans-Medium"),url(/static/fira-sans-latin-500-5b5e9b66c7d7a36666ba46b9357141e5.woff2) format("woff2"),url(/static/fira-sans-latin-500-be30c0599c9bc2579e7b5068cf7317dc.woff) format("woff")}@font-face{font-display:swap;font-family:Fira Sans;font-style:italic;font-weight:500;src:local("Fira Sans Medium italic"),local("Fira Sans-Mediumitalic"),url(/static/fira-sans-latin-500italic-6a87a4ecdb7163b30a294c9c06c68df5.woff2) format("woff2"),url(/static/fira-sans-latin-500italic-6086364e458120892cee843bab037e66.woff) format("woff")}@font-face{font-display:swap;font-family:Fira Sans;font-style:normal;font-weight:600;src:local("Fira Sans SemiBold "),local("Fira Sans-SemiBold"),url(/static/fira-sans-latin-600-ecdd56b85d653ab31659f17471e514ab.woff2) format("woff2"),url(/static/fira-sans-latin-600-1e8b0924715e41dfb732c8fab80827e2.woff) format("woff")}@font-face{font-display:swap;font-family:Fira Sans;font-style:italic;font-weight:600;src:local("Fira Sans SemiBold italic"),local("Fira Sans-SemiBolditalic"),url(/static/fira-sans-latin-600italic-7561fe96453b97d00bf56e6bb81adac7.woff2) format("woff2"),url(/static/fira-sans-latin-600italic-aebb3b19f57cdca793daf16b07414ee5.woff) format("woff")}@font-face{font-display:swap;font-family:Fira Sans;font-style:normal;font-weight:700;src:local("Fira Sans Bold "),local("Fira Sans-Bold"),url(/static/fira-sans-latin-700-7dd49ebd00e4fdf9279d5539a7fdd049.woff2) format("woff2"),url(/static/fira-sans-latin-700-c02977de162d598cec8f1f943435d3c6.woff) format("woff")}@font-face{font-display:swap;font-family:Fira Sans;font-style:italic;font-weight:700;src:local("Fira Sans Bold italic"),local("Fira Sans-Bolditalic"),url(/static/fira-sans-latin-700italic-0be63534599fc668f14baadda39980a3.woff2) format("woff2"),url(/static/fira-sans-latin-700italic-0802094e589562f558dccf8a77c7aba6.woff) format("woff")}@font-face{font-display:swap;font-family:Fira Sans;font-style:normal;font-weight:800;src:local("Fira Sans ExtraBold "),local("Fira Sans-ExtraBold"),url(/static/fira-sans-latin-800-d819665f46b8e13fa15cb2331f0600f7.woff2) format("woff2"),url(/static/fira-sans-latin-800-44c0059fac35e8f2b32b629a5c6895f8.woff) format("woff")}@font-face{font-display:swap;font-family:Fira Sans;font-style:italic;font-weight:800;src:local("Fira Sans ExtraBold italic"),local("Fira Sans-ExtraBolditalic"),url(/static/fira-sans-latin-800italic-d5010b2e989d38f1e7b5b7f914bc924b.woff2) format("woff2"),url(/static/fira-sans-latin-800italic-32bfbce2f06e6357d8a2cec055dfe857.woff) format("woff")}@font-face{font-display:swap;font-family:Fira Sans;font-style:normal;font-weight:900;src:local("Fira Sans Black "),local("Fira Sans-Black"),url(/static/fira-sans-latin-900-2e98c06aae106654e9c69f2de217b552.woff2) format("woff2"),url(/static/fira-sans-latin-900-42b1ee37e02a2a61f68c8151fd2c0b58.woff) format("woff")}@font-face{font-display:swap;font-family:Fira Sans;font-style:italic;font-weight:900;src:local("Fira Sans Black italic"),local("Fira Sans-Blackitalic"),url(/static/fira-sans-latin-900italic-b0ef5a726ed21cbd94b714b010333e17.woff2) format("woff2"),url(/static/fira-sans-latin-900italic-05f104ba227dcad0421836e8f9ae489b.woff) format("woff")}code[class*=language-],pre[class*=language-]{word-wrap:normal;color:#657b83;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;-webkit-hyphens:none;hyphens:none;line-height:1.5;tab-size:4;text-align:left;white-space:pre;word-break:normal;word-spacing:normal}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{background:#073642}pre[class*=language-]{border-radius:.3em;margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-],pre[class*=language-]{background-color:#fdf6e3}:not(pre)>code[class*=language-]{border-radius:.3em;padding:.1em}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#93a1a1}.token.punctuation{color:#586e75}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#268bd2}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string,.token.url{color:#2aa198}.token.entity{background:#eee8d5;color:#657b83}.token.atrule,.token.attr-value,.token.keyword{color:#859900}.token.class-name,.token.function{color:#b58900}.token.important,.token.regex,.token.variable{color:#cb4b16}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}:root{--a-dark:#191308;--a-cold:#003249;--a-dark-warm:#372248;--a-warm:#ba1f33;--a-light:#eaeaea;--a-dark-1:#171208;--a-cold-1:#002e43;--a-dark-warm-1:#321f42;--a-warm-1:#aa1d2f;--a-light-1:#d5d5d5;--b-dark:#11001c;--b-dark-warm:#270722;--b-cold:#4f6367;--b-green:#498467;--b-light:#98b6b1;--c-dark:#070707;--c-dark-cold-2:#0d1f2d;--c-dark-cold-1:#084c61;--c-dark-cold-grey:#413f54;--c-cool:#177e89;--c-dark-neutral:#362417;--c-dark-warmer:#321325;--c-warm:#a50104;--c-neutral:#849483;--c-warning:#fcba04;--c-light-1:#d9dbf1;--c-light:#f7f7ff}.my-figure *>img{margin-bottom:0}.my-figure>figcaption{font-style:italic;font-weight:light;text-align:center}</style><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="dns-prefetch" href="https://www.google-analytics.com"/><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){const t=e.target;if(void 0===t.dataset.mainImage)return;if(void 0===t.dataset.gatsbyImageSsr)return;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><style>body[data-gatsby-plugin-fix-fouc-is-loading]{opacity:1}@media(min-width:0px){body[data-gatsby-plugin-fix-fouc-is-loading]{opacity:0}}</style><noscript><style>body[data-gatsby-plugin-fix-fouc-is-loading]{opacity:1!important}</style></noscript><script>(function(){setTimeout(function(){try{if(document.body.dataset["gatsbyPluginFixFoucIsLoading"]!==undefined){delete document.body.dataset["gatsbyPluginFixFoucIsLoading"]}}catch(e){}},4000)})();</script><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><title data-react-helmet="true">Errors and Either | Jean-Louis Leysens</title><link href="//fonts.googleapis.com/css?family=Patua+One:400|Cabin+Condensed:400,700" rel="stylesheet" type="text/css"/></head><body data-gatsby-plugin-fix-fouc-is-loading="true"><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="sc-fsYfdN pKfKR"><header class="sc-beySPh keXyWF"><div direction="column" alignItems="center" class="sc-jTQCzO eVyPVf"><div class="sc-gLLuof cDGDXm"><h3 class="sc-iBdnpw kUcCTs"><a style="box-shadow:none;text-decoration:none;color:inherit" href="/">J<span style="font-family:sans-serif">λ</span>O</a></h3></div></div></header><div class="sc-jTQCzO iGkZTY"><div class="sc-qZrbh kOowzU"><a style="font-size:2.25rem" href="/code/">&lt;</a></div><div class="sc-gLLuof cDGDXm"><main class="sc-hLQSwg ECGdc"><h1>Errors and Either</h1><p style="font-size:0.87055rem;line-height:1.5rem;display:block;margin-bottom:1.5rem;margin-top:-1.5rem">March 25, 2020</p><div style="font-size:0.8409rem;line-height:1.5rem;text-align:justify"><br />
<p>Welcome to yet another post on the Internet about Monads! I am only mostly
kidding. I do not intend to use this post as an introduction to
Monads<sup>1</sup>. This post is actually a continuation of <a href="../errors">my post on
errors</a>, and I would like to dig into the practical upshots of
implementing more thorough and efficient means of handling errors.
Specifically I am picking up the sentiment that <em>we can do better</em>. Using
<code class="language-text">Either</code> is one version of doing better that I’d like to consider in this
post.</p>
<p>Consider the following diagram:</p>
<figure class="my-figure">
  <a name="fig1">
    <img src="../../pics/either/myprogram1.png" alt="My program figure 1" title="My program figure 1">
  </a>
  <figcaption>Figure 1</figcaption>
</figure>
<p>Figure 1 features elements of a typical program; a start point, branch
conditions and terminus points. Real programs could be expressed as sets of
these diagrams linked together, one’s output the input of the next. Our
branching here is focused on errors. Each diamond is a point at which we take
an action that <em>could</em> result in an error condition. The <code class="language-text">s</code> branch indicates
a successful result where the <code class="language-text">e</code> branch indicates an unsuccessful result.
This is the error <em>control flow</em> inherent in any program that could have
error conditions.</p>
<p>The different terminus nodes indicate different end states that our program
can reach. Each end state indicates a different <em>type</em> of output. This toy
program has four different potential terminus states. Following this pattern
we can imagine that if <a href="./#fig1">Figure 1</a> program grew to any level of complexity there
would be explosion of terminus states as new points of error are introduced.</p>
<p>Moreover, think about what the terminus point represents the end of the
programmers <em>intent</em>. It is saying “We have reached this point without
generating the outcome we had hoped, so send a message back <em>expressing this
unexpected event</em>”. These intentions exist implicitly or explicitly in our
programs.</p>
<p>This may sound like an ungracious description of how many programs work, but
practice is often not far off from this. Consider this JavaScript:</p>
<div class="gatsby-highlight" data-language="javascript"><pre style="counter-reset: linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token keyword">let</span> locked <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">lockSomeResource</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  locked <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">unlockSomeResource</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  locked <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">doSomethingDangerous</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'You got burned!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> resource <span class="token operator">=</span> <span class="token string">'resource'</span><span class="token punctuation">;</span>

<span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> locked <span class="token operator">=</span> <span class="token function">lockSomeResource</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">doSomethingDangerous</span><span class="token punctuation">(</span>locked<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
  <span class="token function">unlockSomeResource</span><span class="token punctuation">(</span>locked<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>This code is a representation of one of the diamonds in <a href="./#fig1">Figure 1</a>.
Clearly we will reach the <code class="language-text">e</code> branch. And log the error to the browser
console. But consider what might happen if unlocking the resource is a known
potential point of error too. To achieve our goal of improved error messages
we might make the following alterations:</p>
<div class="gatsby-highlight" data-language="javascript"><pre style="counter-reset: linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token keyword">let</span> locked <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">lockSomeResource</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  locked <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">unlockSomeResource</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Nope!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">doSomethingCoolButDangerous</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'You got burned!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">myFunction1</span> <span class="token operator">=</span> <span class="token parameter">resource</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> locked <span class="token operator">=</span> <span class="token function">lockSomeResource</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">doSomethingCoolButDangerous</span><span class="token punctuation">(</span>locked<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>
      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">something went wrong with locking the resource or doing something dangerous, either way: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>e<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token function">unlockSomeResource</span><span class="token punctuation">(</span>locked<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">could not unlock the resource because: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>e<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">myFunction1</span><span class="token punctuation">(</span><span class="token string">'resource'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>The snippet above is a representation of a path in <a href="./#fig1">Figure 1</a> where
we reach two, successive error conditions. Nested try-catch blocks may seem
like overkill but they are the only way to ensure that our error states are
kept in check. We can continue to flesh out this example and perhaps refactor
our code so that each potentially dangerous call is inside of it’s own
try-catch block, we may even be tempted to provide a more generic way of
provisioning these try-catch-finally blocks for functions. Another point to notice here is that we have
assumed <code class="language-text">myFunction1</code> should return something to the caller. Either it is the
result of <code class="language-text">doSomethingCoolButDangerous</code> or it is <code class="language-text">undefined</code>
— returning <code class="language-text">undefined</code> is our implicit way of communicating that something went wrong,
let’s say we made this part of our contract to calling code. This is how a
lot of programs operate. I would assert we can do better than this,
and write less code with less nesting. Consider this revision to our graph:</p>
<figure class="my-figure">
  <a name="fig2">
    <img src="../../pics/either/myprogram2.png" alt="My program figure 2" title="My program figure 2">
  </a>
  <figcaption>Figure 2</figcaption>
</figure>
<p>In the figure above we have eliminated all terminus points but one. In some sense
the diamonds have been made <em>totally irrelevant</em> to the output of our
program. I would like to demonstrate that this is what the <code class="language-text">Either</code> monad
was made for. All paths lead to one output, no matter what happens. <code class="language-text">Either</code> can be considered an abstract way
of expressing uncertainty in our programs and so it is a very general data
type<sup>2</sup>. The way <code class="language-text">Either</code> makes this possible is by placing the
result of our function inside of a <em>tagged container</em>. It is this tagging
that lets subsequent code know whether some went right or wrong, in <code class="language-text">Either</code>
terms; <em>left</em> or <em>right</em>. Left denotes a failure where right denotes a success.
By placing values inside of containers like this we are able to associate some
metadata with the a given output. Consider this example (in TypeScript):</p>
<div class="gatsby-highlight" data-language="typescript"><pre style="counter-reset: linenumber NaN" class="language-typescript line-numbers"><code class="language-typescript"><span class="token keyword">const</span> <span class="token function-variable function">unsafeJSONParse</span><span class="token operator">:</span> <span class="token punctuation">(</span>unknownString<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=></span> object <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span>parse<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>This function can easily represent one of the diamonds in our program where
an unknown string value can be passed in and one of two things will happen:
an error, or a newly minted object. Consider this revision with <code class="language-text">Either</code> as
implemented by <a href="https://github.com/gcanti/fp-ts/blob/dcf0b105061c99ea6c82abba31800d544fb851d5/src/Either.ts#L64">fp-ts</a>:</p>
<div class="gatsby-highlight" data-language="typescript"><pre style="counter-reset: linenumber NaN" class="language-typescript line-numbers"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> tryCatch<span class="token punctuation">,</span> Either <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'fp-ts/lib/Either'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> jsonParse <span class="token operator">=</span> <span class="token punctuation">(</span>unknownString<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> Either<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> object<span class="token operator">></span> <span class="token operator">=></span>
  <span class="token function">tryCatch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>unknownString<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> Error<span class="token punctuation">)</span> <span class="token operator">=></span> e<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>
<p>This is slightly more verbose for a start, but if we look at the return type
we are now returning an <code class="language-text">Either</code><sup>3</sup>! This change is most important
at a <code class="language-text">type</code> level: we have now declared that <code class="language-text">jsonParse</code> no longer produces
an <code class="language-text">object</code> but <code class="language-text">Right&lt;object></code> <em>or</em> <code class="language-text">Left&lt;string></code>. The <code class="language-text">Right</code> <em>or</em> <code class="language-text">Left</code>
result of this function is what enables us to eliminate other terminus
points. Furthermore we can now more generically handle control flow
introduced by errors. There is no need to ever have a nested try-catch block
again. Returning to our example from before, we can refactor like so (still
using fp-ts, though specific fp-ts knowledge is not required):</p>
<div class="gatsby-highlight" data-language="typescript"><pre style="counter-reset: linenumber NaN" class="language-typescript line-numbers"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> pipe <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'fp-ts/lib/pipeable'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>
  Either <span class="token comment">/* &lt;- Type only */</span><span class="token punctuation">,</span>
  either<span class="token punctuation">,</span>
  left<span class="token punctuation">,</span>
  right<span class="token punctuation">,</span>
  isRight<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'fp-ts/lib/Either'</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> locked <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> lockSomeResource <span class="token operator">=</span> <span class="token punctuation">(</span>
  eitherR<span class="token operator">:</span> Either<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">any</span><span class="token operator">></span>
<span class="token punctuation">)</span><span class="token operator">:</span> Either<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">any</span><span class="token operator">></span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isRight</span><span class="token punctuation">(</span>eitherR<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    locked <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">right</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token function">left</span><span class="token punctuation">(</span><span class="token string">'oops!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> unlockSomeResource <span class="token operator">=</span> <span class="token punctuation">(</span>
  eitherR<span class="token operator">:</span> Either<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">any</span><span class="token operator">></span>
<span class="token punctuation">)</span><span class="token operator">:</span> Either<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token keyword">void</span><span class="token operator">></span> <span class="token operator">=></span>
  <span class="token function">isRight</span><span class="token punctuation">(</span>eitherR<span class="token punctuation">)</span>
    <span class="token operator">?</span> <span class="token function">left</span><span class="token punctuation">(</span><span class="token string">'Try to unlock the resource but we failed'</span><span class="token punctuation">)</span>
    <span class="token operator">:</span> <span class="token function">left</span><span class="token punctuation">(</span><span class="token string">'Something upstream failed, we do not have a resource to unlock'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> doSomethingCoolButDangerous <span class="token operator">=</span> <span class="token punctuation">(</span>
  eitherR<span class="token operator">:</span> Either<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">any</span><span class="token operator">></span>
<span class="token punctuation">)</span><span class="token operator">:</span> Either<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">any</span><span class="token operator">></span> <span class="token operator">=></span>
  <span class="token function">isRight</span><span class="token punctuation">(</span>eitherR<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token function">left</span><span class="token punctuation">(</span><span class="token string">'You got burned!'</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">left</span><span class="token punctuation">(</span><span class="token string">'You got burned!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">myFunction1</span> <span class="token operator">=</span> <span class="token punctuation">(</span>resource<span class="token operator">:</span> Either<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">any</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">pipe</span><span class="token punctuation">(</span>
    <span class="token function">lockSomeResource</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">,</span>
    doSomethingCoolButDangerous<span class="token punctuation">,</span>
    unlockSomeResource
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">myFunction1</span><span class="token punctuation">(</span>either<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">'resource'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Ok, that was an explosion of new code that looks very FP! You may be
wondering how on earth this is an improvement over the nested try-catch and
at this point it really is not. For instance, there seems to be more repeated
code, albeit not-nested. Also, what is this <code class="language-text">either.of</code>? What is <code class="language-text">pipe</code> even?
I would challenge the reader to not dig too deeply into those concepts but
rather to look at the body of <code class="language-text">myFunction1</code>. What is being described there?
Take a moment to think about what the result of calling
<code class="language-text">myFunction1(either.of('resource'));</code> might be.</p>
<br/>
<br/>
<p>Ok, it’s:</p>
<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">{ _tag: 'Left',
  left:
   'Something upstream failed, we do not have a resource to unlock' }</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>
<p>Trace through the code and consider how we arrived at <em>this</em> result.</p>
<p>Consider that we still have a fairly imperative way of laying out
instructions. The primary change has been to separate steps into functions
and we now have the <code class="language-text">Either</code> machinery so we don’t deal with values directly.
Instead, we interact with a <em>container</em> that has been <em>tagged</em> which
carries our value. In each of our functions we now accept <code class="language-text">Either</code> and return
<code class="language-text">Either</code>. At a type level we have achieved the simplification of our graph —
one terminus — but at the cost of developer experience and ergonomics.
Someone once told me that we don’t abstract something unless you have at least
three different instances of the same thing as a guiding rule. In the refactor above we
are repeatedly checking our code for <code class="language-text">isRight</code> and then taking some action
based on that. We are wrestling with control flow at a <em>lower level</em>.
However, I would argue that this is a very similar algorithm to what we had
above except that each point of error has been exposed and is being handled!</p>
<p>The container itself is our signal for control flow through
our program. Currently it is cumbersome and we can certainly do
better — fortunately others have already noticed this; consider a further
revision:</p>
<div class="gatsby-highlight" data-language="typescript"><pre style="counter-reset: linenumber NaN" class="language-typescript line-numbers"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span>
  either<span class="token punctuation">,</span>
  map<span class="token punctuation">,</span>
  mapLeft<span class="token punctuation">,</span>
  bimap<span class="token punctuation">,</span>
  chain<span class="token punctuation">,</span>
  tryCatch<span class="token punctuation">,</span>
  fold<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'fp-ts/lib/Either'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> identity <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'fp-ts/lib/function'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> pipe <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'fp-ts/lib/pipeable'</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> locked <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> lockSomeResource <span class="token operator">=</span> <span class="token punctuation">(</span>res<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">any</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  locked <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> unlockSomeResource <span class="token operator">=</span> <span class="token punctuation">(</span>res<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Try to unlock the resource but we failed'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> doSomethingCoolButDangerous <span class="token operator">=</span> <span class="token punctuation">(</span>res<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">any</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'You got burned!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">myFunction1</span> <span class="token operator">=</span> <span class="token punctuation">(</span>resource<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">pipe</span><span class="token punctuation">(</span>
    either<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">map</span><span class="token punctuation">(</span>lockSomeResource<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">mapLeft</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'this never runs!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">chain</span><span class="token punctuation">(</span>res <span class="token operator">=></span>
      <span class="token function">tryCatch</span><span class="token punctuation">(</span>
        <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">doSomethingCoolButDangerous</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span>e<span class="token operator">:</span> Error<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span> e<span class="token punctuation">,</span> res <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">bimap</span><span class="token punctuation">(</span>
      <span class="token punctuation">(</span><span class="token punctuation">{</span> e<span class="token punctuation">,</span> res <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span>
        <span class="token function">tryCatch</span><span class="token punctuation">(</span>
          <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">unlockSomeResource</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">(</span>_e<span class="token operator">:</span> Error<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Our final result, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>e<span class="token punctuation">.</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> and </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>_e<span class="token punctuation">.</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">(</span>res<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=></span>
        <span class="token function">tryCatch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">unlockSomeResource</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token string">'Not our final result'</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">fold</span><span class="token punctuation">(</span>identity<span class="token punctuation">,</span> identity<span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">myFunction1</span><span class="token punctuation">(</span><span class="token string">'resource'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>We are now close to a final version and our original <code class="language-text">myFunction1</code> is
intact. Control flow is now happening at a higher level thanks to the
different functions (or operators) for working with data types. Technically there is still
some amount of “nesting” but we will never need to go deeper than this. There
are some more advanced operations being used on the container such as <code class="language-text">chain</code>
and if you have checked out the linked resources you will be familiar with
what all these operators do<sup>4</sup>. This time our output looks like:</p>
<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">{ _tag: 'Left',
  left:
   'Our final result, You got burned! &lt;and> Try to unlock the resource but we failed' }</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>
<p>Hopefully this discussion has piqued your interest for digging deeper into
how we might better handle errors in our code. There are, of course,
different theses about using abstract data types to handle values in this
way<sup>4</sup>. For now, thanks for reading!</p>
<h3>Notes</h3>
<ol>
<li>The <a href="https://github.com/MostlyAdequate/mostly-adequate-guide">Mostly adequate guide</a> does an excellent
job of getting hands on with Monads and I would highly recommend checking it out.</li>
<li>See the <a href="https://github.com/fantasyland/fantasy-land#fantasy-land-specification">fantasy land specification</a>
for where Monads fit in with other general data types. <code class="language-text">Maybe</code> is a similar instance to <code class="language-text">Either</code> but it uses different tags.</li>
<li>fp-ts already has an implementation of <code class="language-text">jsonParse</code> called <code class="language-text">parseJson</code>, but I decided to implement one as
it is a nice simple case for getting started.</li>
<li>I would challenge the reader to create handler called <code class="language-text">always</code> that takes a left or a right and runs the same
function</li>
<li><a href="https://youtu.be/YR5WdGrpoug">This talk</a> by Rich Hickey is quite a famous one that contains a lot of wisdom regarding some of the pitfalls of
abstract data types.</li>
</ol></div><ul style="display:flex;flex-wrap:wrap;justify-content:space-between;list-style:none;padding:0"><li><a rel="prev" href="/code/errors/">← <!-- -->Errors</a></li><li><a rel="next" href="/code/todo/">TODO<!-- --> →</a></li></ul><hr style="margin-top:0.75rem;margin-bottom:1.5rem"/><div direction="column" style="margin-bottom:3.75rem" class="sc-jTQCzO bJyvrm"><div class="sc-gLLuof cDGDXm"><p>Hi, I&#x27;m <strong>Jean-Louis Leysens</strong>. I like writing software in JavaScript and TypeScript and listening to noisey music.</p></div><div class="sc-gLLuof cDGDXm"><span role="img"><a target="_blank" href="https://www.github.com/jloleysens"><svg width="1rem" height="1rem" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="sc-eDLKkx jQvHvV"><path fill-rule="evenodd" clip-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8C0 11.54 2.29 14.53 5.47 15.59C5.87 15.66 6.02 15.42 6.02 15.21C6.02 15.02 6.01 14.39 6.01 13.72C4 14.09 3.48 13.23 3.32 12.78C3.23 12.55 2.84 11.84 2.5 11.65C2.22 11.5 1.82 11.13 2.49 11.12C3.12 11.11 3.57 11.7 3.72 11.94C4.44 13.15 5.59 12.81 6.05 12.6C6.12 12.08 6.33 11.73 6.56 11.53C4.78 11.33 2.92 10.64 2.92 7.58C2.92 6.71 3.23 5.99 3.74 5.43C3.66 5.23 3.38 4.41 3.82 3.31C3.82 3.31 4.49 3.1 6.02 4.13C6.66 3.95 7.34 3.86 8.02 3.86C8.7 3.86 9.38 3.95 10.02 4.13C11.55 3.09 12.22 3.31 12.22 3.31C12.66 4.41 12.38 5.23 12.3 5.43C12.81 5.99 13.12 6.7 13.12 7.58C13.12 10.65 11.25 11.33 9.47 11.53C9.76 11.78 10.01 12.26 10.01 13.01C10.01 14.08 10 14.94 10 15.21C10 15.42 10.15 15.67 10.55 15.59C13.71 14.53 16 11.53 16 8C16 3.58 12.42 0 8 0Z" transform="scale(64)"></path></svg></a></span><div style="margin-left:1.5rem"></div><a style="font-size:0.8rem" href="/pgp-public.txt.asc" download="">My public PGP key</a></div></div></main></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-65971085-2', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/code/either/";/*]]>*/</script><!-- slice-start id="_gatsby-scripts-1" -->
          <script
            id="gatsby-chunk-mapping"
          >
            window.___chunkMapping="{\"app\":[\"/app-444f450a2a5d96d62bef.js\"],\"component---cache-caches-gatsby-plugin-offline-app-shell-js\":[\"/component---cache-caches-gatsby-plugin-offline-app-shell-js-001a5ff2c950bfb4c865.js\"],\"component---src-pages-404-tsx\":[\"/component---src-pages-404-tsx-34dee1cb2cd622ebd46f.js\"],\"component---src-pages-code-tsx\":[\"/component---src-pages-code-tsx-0d9de92cc05636ece806.js\"],\"component---src-pages-index-tsx\":[\"/component---src-pages-index-tsx-9feba3c98eb7d211351b.js\"],\"component---src-pages-music-tsx\":[\"/component---src-pages-music-tsx-bb4534c88a3713b17529.js\"],\"component---src-pages-video-games-tsx\":[\"/component---src-pages-video-games-tsx-fc5286f7004167fab83e.js\"],\"component---src-templates-blog-post-tsx\":[\"/component---src-templates-blog-post-tsx-405d3b6fb1cf0e7fc9b6.js\"]}";
          </script>
        <script>window.___webpackCompilationHash="90a46ddbd25bc407c64b";</script><script src="/webpack-runtime-8c24c8f503f47bc06b6f.js" async></script><script src="/framework-7b18d482cc15d22ded3f.js" async></script><script src="/app-444f450a2a5d96d62bef.js" async></script><!-- slice-end id="_gatsby-scripts-1" --></body></html>